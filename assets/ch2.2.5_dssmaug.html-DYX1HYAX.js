import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as l,c as t,e,a as s}from"./app-SD3SAAIy.js";const n={},i=e('<h3 id="双塔模型的线上召回" tabindex="-1"><a class="header-anchor" href="#双塔模型的线上召回"><span>双塔模型的线上召回</span></a></h3><h4 id="离线存储-把物品向量b存入向量数据库" tabindex="-1"><a class="header-anchor" href="#离线存储-把物品向量b存入向量数据库"><span>离线存储：把物品向量b存入向量数据库</span></a></h4><ol><li>完成物品塔的训练之后，用物品塔计算每个物品的特征向量b。</li><li>把几亿个物品向量b存入向量数据库（如Milvus、Faiss、HnswLib）。</li><li>建立向量数据库索引，以加速最近邻查找（如分区、建树以便使用分支定界等）。</li></ol><h4 id="线上召回-查找用户最感兴趣的k个物品" tabindex="-1"><a class="header-anchor" href="#线上召回-查找用户最感兴趣的k个物品"><span>线上召回：查找用户最感兴趣的k个物品</span></a></h4><ol><li>给定用户ID和画像，线上用神经网络算用户向量a。</li><li>最近邻查找： <ul><li>把向量a作为query，调用向量数据库做最近邻查找。</li><li>返回余弦相似度最大的k个物品，作为召回结果。</li></ul></li><li>和其他召回通道的结果合并，返回最终的召回结果。</li></ol><h4 id="问题-为什么物品向量是事先存储的-而用户向量是线上实时计算的呢" tabindex="-1"><a class="header-anchor" href="#问题-为什么物品向量是事先存储的-而用户向量是线上实时计算的呢"><span>问题：为什么物品向量是事先存储的，而用户向量是线上实时计算的呢？</span></a></h4><ol><li>效率问题：每做一次召回，用到一个用户向量a，几亿物品向量b。（线上算物品向量的代价过大）</li><li>用户兴趣动态变化，而物品特征相对稳定。（可以离线存储用户向量，但不利于推荐效果）</li><li>如果用户向量不随着其action而变化，那么用户每次刷新得到的结果都是相同的，这自然是很不合适的。</li></ol><h2 id="双塔模型的自监督" tabindex="-1"><a class="header-anchor" href="#双塔模型的自监督"><span>双塔模型的自监督</span></a></h2><h3 id="双塔模型的问题" tabindex="-1"><a class="header-anchor" href="#双塔模型的问题"><span>双塔模型的问题</span></a></h3><ul><li>推荐系统的头部效应严重： <ul><li>少部分物品占据大部分点击。</li><li>大部分物品的点击次数不高。</li></ul></li><li>高点击物品的表征学得好，长尾物品的表征学得不好。</li><li>自监督学习：做data augmentation，更好的学习长尾物品的向量表征。</li></ul><blockquote><p>参考文献：Yao T, Yi X, Cheng D Z, et al. Self-supervised learning for large-scale item recommendations[C]//Proceedings of the 30th ACM International Conference on Information &amp; Knowledge Management. 2021: 4321-4330.</p></blockquote><h3 id="自监督想法" tabindex="-1"><a class="header-anchor" href="#自监督想法"><span>自监督想法</span></a></h3><p>将物品用不同的特征变换，通过物品塔后输出其向量表征，同一物品的不同表征应该有较高的相似度，不同物品的表征应该有较低的相似度。</p><p>特征变换方法：</p><ul><li>Random Mask：随机选一些离散特征（比如类目），把它们遮住。</li><li>Dropout：随机丢弃特征中50%的值，仅对多值离散特征生效。</li><li>Complementary：互补特征，也即把物品的特征随机分为两组，比如物品有四种特征，ID、类目、物品、城市，把它分为两组：「ID、default、物品、default」和「default、类目、default、城市」，这两组之间应该有较高的相似度。（和MAE的自监督学习特别特别像）</li><li>Mask一组关联的特征：比如受众性别为女性和类目为美妆同时出现的概率大，也即特征之间存在关联。离线计算互信息用来衡量特征两两之间的关联，然后随机选一个特征作为种子，然后找到种子特征最相关的k/2种特征，然后将其全部mask。 <ul><li>优点：比Random Mask、Dropout、Complementary效果好。</li><li>缺点：方法复杂，实现难度大，不容易维护。投入产出比不高，很少使用。</li></ul></li></ul><h3 id="训练模型" tabindex="-1"><a class="header-anchor" href="#训练模型"><span>训练模型</span></a></h3><ul><li>对点击做随机抽样，得到n对用户-物品二元组，作为一个batch，用于训练双塔模型。</li><li>从全体物品中均匀抽样，得到m个物品，作为一个batch，用于自监督训练物品塔。</li><li>做梯度下降使以下损失最小：前面为双塔模型损失，后面为自监督学习的损失，中间的超参数控制自监督的使用度。</li></ul>',17),m=s("p",{class:"katex-block"},[s("span",{class:"katex-display"},[s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("semantics",null,[s("mrow",null,[s("mfrac",null,[s("mn",null,"1"),s("mi",null,"n")]),s("munderover",null,[s("mo",null,"∑"),s("mrow",null,[s("mi",null,"i"),s("mo",null,"="),s("mn",null,"1")]),s("mi",null,"n")]),s("msub",null,[s("mi",null,"L"),s("mrow",null,[s("mi",{mathvariant:"normal"},"m"),s("mi",{mathvariant:"normal"},"a"),s("mi",{mathvariant:"normal"},"i"),s("mi",{mathvariant:"normal"},"n")])]),s("mo",{stretchy:"false"},"["),s("mi",null,"i"),s("mo",{stretchy:"false"},"]"),s("mo",null,"+"),s("mi",null,"α"),s("mo",null,"⋅"),s("mfrac",null,[s("mn",null,"1"),s("mi",null,"m")]),s("munderover",null,[s("mo",null,"∑"),s("mrow",null,[s("mi",null,"j"),s("mo",null,"="),s("mn",null,"1")]),s("mi",null,"m")]),s("msub",null,[s("mi",null,"L"),s("mrow",null,[s("mi",{mathvariant:"normal"},"s"),s("mi",{mathvariant:"normal"},"e"),s("mi",{mathvariant:"normal"},"l"),s("mi",{mathvariant:"normal"},"f")])]),s("mo",{stretchy:"false"},"["),s("mi",null,"j"),s("mo",{stretchy:"false"},"]")]),s("annotation",{encoding:"application/x-tex"}," \\frac{1}{n}\\sum_{i=1}^{n}L_{\\mathrm{main}}[i] + \\alpha\\cdot\\frac{1}{m}\\sum_{j=1}^{m}L_{\\mathrm{self}}[j] ")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"2.9291em","vertical-align":"-1.2777em"}}),s("span",{class:"mord"},[s("span",{class:"mopen nulldelimiter"}),s("span",{class:"mfrac"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"1.3214em"}},[s("span",{style:{top:"-2.314em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"n")])]),s("span",{style:{top:"-3.23em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"frac-line",style:{"border-bottom-width":"0.04em"}})]),s("span",{style:{top:"-3.677em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"mord"},[s("span",{class:"mord"},"1")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.686em"}},[s("span")])])])]),s("span",{class:"mclose nulldelimiter"})]),s("span",{class:"mspace",style:{"margin-right":"0.1667em"}}),s("span",{class:"mop op-limits"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"1.6514em"}},[s("span",{style:{top:"-1.8723em","margin-left":"0em"}},[s("span",{class:"pstrut",style:{height:"3.05em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mathnormal mtight"},"i"),s("span",{class:"mrel mtight"},"="),s("span",{class:"mord mtight"},"1")])])]),s("span",{style:{top:"-3.05em"}},[s("span",{class:"pstrut",style:{height:"3.05em"}}),s("span",null,[s("span",{class:"mop op-symbol large-op"},"∑")])]),s("span",{style:{top:"-4.3em","margin-left":"0em"}},[s("span",{class:"pstrut",style:{height:"3.05em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mathnormal mtight"},"n")])])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"1.2777em"}},[s("span")])])])]),s("span",{class:"mspace",style:{"margin-right":"0.1667em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"L"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.3175em"}},[s("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mathrm mtight"},"main")])])])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])]),s("span",{class:"mopen"},"["),s("span",{class:"mord mathnormal"},"i"),s("span",{class:"mclose"},"]"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"+"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.4445em"}}),s("span",{class:"mord mathnormal",style:{"margin-right":"0.0037em"}},"α"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"⋅"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"3.0652em","vertical-align":"-1.4138em"}}),s("span",{class:"mord"},[s("span",{class:"mopen nulldelimiter"}),s("span",{class:"mfrac"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"1.3214em"}},[s("span",{style:{top:"-2.314em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"m")])]),s("span",{style:{top:"-3.23em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"frac-line",style:{"border-bottom-width":"0.04em"}})]),s("span",{style:{top:"-3.677em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"mord"},[s("span",{class:"mord"},"1")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.686em"}},[s("span")])])])]),s("span",{class:"mclose nulldelimiter"})]),s("span",{class:"mspace",style:{"margin-right":"0.1667em"}}),s("span",{class:"mop op-limits"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"1.6514em"}},[s("span",{style:{top:"-1.8723em","margin-left":"0em"}},[s("span",{class:"pstrut",style:{height:"3.05em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mathnormal mtight",style:{"margin-right":"0.05724em"}},"j"),s("span",{class:"mrel mtight"},"="),s("span",{class:"mord mtight"},"1")])])]),s("span",{style:{top:"-3.05em"}},[s("span",{class:"pstrut",style:{height:"3.05em"}}),s("span",null,[s("span",{class:"mop op-symbol large-op"},"∑")])]),s("span",{style:{top:"-4.3em","margin-left":"0em"}},[s("span",{class:"pstrut",style:{height:"3.05em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mathnormal mtight"},"m")])])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"1.4138em"}},[s("span")])])])]),s("span",{class:"mspace",style:{"margin-right":"0.1667em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"L"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.3361em"}},[s("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mathrm mtight",style:{"margin-right":"0.07778em"}},"self")])])])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])]),s("span",{class:"mopen"},"["),s("span",{class:"mord mathnormal",style:{"margin-right":"0.05724em"}},"j"),s("span",{class:"mclose"},"]")])])])])],-1),p=[i,m];function r(c,h){return l(),t("div",null,p)}const d=a(n,[["render",r],["__file","ch2.2.5_dssmaug.html.vue"]]),u=JSON.parse('{"path":"/rcmd/ch02/ch2.2/ch2.2.5_dssmaug.html","title":"双塔召回训练及增强","lang":"zh-CN","frontmatter":{"date":"2024-06-13T00:00:00.000Z","title":"双塔召回训练及增强","author":"Genhiy","order":5,"category":["推荐系统"],"tag":["无标签"],"feed":false,"seo":false,"head":[]},"headers":[{"level":3,"title":"双塔模型的线上召回","slug":"双塔模型的线上召回","link":"#双塔模型的线上召回","children":[]},{"level":2,"title":"双塔模型的自监督","slug":"双塔模型的自监督","link":"#双塔模型的自监督","children":[{"level":3,"title":"双塔模型的问题","slug":"双塔模型的问题","link":"#双塔模型的问题","children":[]},{"level":3,"title":"自监督想法","slug":"自监督想法","link":"#自监督想法","children":[]},{"level":3,"title":"训练模型","slug":"训练模型","link":"#训练模型","children":[]}]}],"git":{},"readingTime":{"minutes":3.26,"words":978},"filePathRelative":"rcmd/ch02/ch2.2/ch2.2.5_dssmaug.md","localizedDate":"2024年6月13日"}');export{d as comp,u as data};
